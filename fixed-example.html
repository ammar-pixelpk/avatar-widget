<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fixed Widget Integration</title>
    
    <!-- Widget Styles -->
    <link rel="stylesheet" href="./assets/ai-avatar.css">
    
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .content {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .status {
            padding: 12px;
            margin: 10px 0;
            border-radius: 6px;
            font-weight: 500;
        }
        
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #b8daff; }
        
        /* Widget positioned in bottom-right corner */
        .chat-widget {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
        }
        
        .retry-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }
        
        .retry-btn:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="content">
        <h1>ü§ñ AI Assistant Integration</h1>
        <p>This page shows the proper way to integrate the AvatarWidget. If you see errors, follow the troubleshooting steps below.</p>
        
        <div id="widget-status" class="status info">
            Initializing AI Assistant...
        </div>
        
        <h2>üîß Troubleshooting Steps</h2>
        
        <h3>1. Check Files</h3>
        <p>Make sure these files exist in your <code>assets/</code> folder:</p>
        <ul>
            <li><code>avatar-widget.umd.js</code> (624KB)</li>
            <li><code>ai-avatar.css</code> (82KB)</li>
        </ul>
        
        <h3>2. Check Configuration</h3>
        <p>Your <code>knowledgeID</code> must be correct. The default one might not work for your setup.</p>
        
        <h3>3. Check Network</h3>
        <p>Open browser DevTools (F12) ‚Üí Network tab ‚Üí Refresh page. Look for:</p>
        <ul>
            <li>‚ùå Any red/failed requests</li>
            <li>‚ùå CORS errors</li>
            <li>‚ùå 404 errors for widget files</li>
        </ul>
        
        <h3>4. Check Console</h3>
        <p>Open browser DevTools (F12) ‚Üí Console tab. Look for error messages.</p>
        
        <div style="background: #f8f9fa; padding: 20px; border-radius: 5px; margin: 20px 0;">
            <h4>üöÄ Quick Fix:</h4>
            <p>If the widget isn't loading, try these Knowledge IDs:</p>
            <ul>
                <li><code>68e604b9028f2f5066e31678</code> (default)</li>
                <li><code>your-actual-knowledge-id</code> (replace with yours)</li>
            </ul>
            <button class="retry-btn" onclick="retryWithDifferentConfig()">Try Alternative Config</button>
        </div>
    </div>

    <!-- Chat Widget Container -->
    <div class="chat-widget">
        <div id="avatar-chat"></div>
    </div>

    <!-- React Dependencies -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Widget Bundle -->
    <script src="./assets/avatar-widget.umd.js"></script>
    
    <script>
        let retryCount = 0;
        
        function updateStatus(message, type = 'info', showRetry = false) {
            const statusEl = document.getElementById('widget-status');
            statusEl.className = `status ${type}`;
            statusEl.innerHTML = message + (showRetry ? '<button class="retry-btn" onclick="initializeWidget()">Retry</button>' : '');
        }
        
        function initializeWidget(alternativeConfig = false) {
            retryCount++;
            
            try {
                updateStatus('üîÑ Loading AI Assistant...', 'info');
                
                // Check if React is loaded
                if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
                    updateStatus('‚ùå React libraries not loaded. Please check your internet connection.', 'error', true);
                    return;
                }
                
                // Check if widget function is available
                if (typeof window.renderAvatarWidget !== 'function') {
                    updateStatus('‚ùå Widget bundle not loaded. Check that avatar-widget.umd.js exists in assets/ folder.', 'error', true);
                    return;
                }
                
                // Clear any existing widget
                const container = document.getElementById('avatar-chat');
                container.innerHTML = '';
                
                // Configuration
                let config = {
                    knowledgeID: '68e604b9028f2f5066e31678',
                    avatarId: 'Tyler-insuit-20220721',
                    openingMessage: 'Hello! I\'m your AI assistant. How can I help you today?'
                };
                
                // Alternative configurations to try
                if (alternativeConfig) {
                    const alternatives = [
                        {
                            knowledgeID: '68e604b9028f2f5066e31678',
                            avatarId: 'Anna_public_3_20240108', // Different avatar
                            openingMessage: 'Hi there! I\'m Anna, your AI assistant.'
                        },
                        {
                            knowledgeID: '68e604b9028f2f5066e31678',
                            avatarId: 'Susan_public_2_20240328', // Another avatar
                            openingMessage: 'Hello! I\'m Susan. How can I assist you?'
                        }
                    ];
                    
                    config = alternatives[(retryCount - 1) % alternatives.length];
                    updateStatus(`üîÑ Trying alternative configuration #${retryCount}...`, 'warning');
                }
                
                // Attempt to render
                window.renderAvatarWidget('avatar-chat', config);
                
                updateStatus('‚úÖ AI Assistant loaded successfully! Look for the purple chat button in the bottom-right corner.', 'success');
                
                // Verify widget actually rendered
                setTimeout(() => {
                    if (container.children.length === 0) {
                        updateStatus('‚ö†Ô∏è Widget function called but no UI appeared. This might be a configuration issue.', 'warning', true);
                    }
                }, 2000);
                
            } catch (error) {
                console.error('Widget initialization error:', error);
                updateStatus(`‚ùå Initialization failed: ${error.message}`, 'error', true);
            }
        }
        
        function retryWithDifferentConfig() {
            initializeWidget(true);
        }
        
        // Enhanced error handling
        window.addEventListener('error', function(e) {
            console.error('Page error:', e.error);
            if (e.message.includes('avatar') || e.message.includes('widget')) {
                updateStatus(`‚ùå Widget error: ${e.message}`, 'error', true);
            }
        });
        
        window.addEventListener('unhandledrejection', function(e) {
            console.error('Promise rejection:', e.reason);
            updateStatus(`‚ùå Network error: ${e.reason}`, 'error', true);
        });
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Add a small delay to ensure all scripts are loaded
            setTimeout(initializeWidget, 100);
        });
        
        // Fallback - initialize after a longer delay if DOMContentLoaded didn't work
        setTimeout(() => {
            if (document.getElementById('widget-status').textContent.includes('Initializing')) {
                initializeWidget();
            }
        }, 2000);
    </script>
</body>
</html>